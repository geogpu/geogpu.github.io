import{L as e,Z as a,G as t,P as s,r as i,C as n,i as o,A as h,B as l,a as r,D as c,E as p,b as d,R as y,v as x}from"./zrender.7929d921.js";import{A as v,j as u,x as C,V as f,W as g,M,P as S,Q as m}from"./@vue.7c4085bf.js";import"./tslib.60310f1a.js";class L{constructor(e,a,t){this.group=e,this.state=a,this._zr=t}show(){let t=this.state.center[0],i=this.state.center[1];this.state.arcs&&this.state.arcs.forEach((e=>{e.shape.cx+=t,e.shape.cy=i-e.shape.cy;let a=new h(e);this.group.add(a)})),this.state.bezierCurves&&this.state.bezierCurves.forEach((e=>{e.shape.x1+=t,e.shape.y1=i-e.shape.y1,e.shape.x2+=t,e.shape.y2=i-e.shape.y2,e.shape.cpx1+=t,e.shape.cpy1=i-e.shape.cpy1;let a=new l(e);this.group.add(a)})),this.state.circles&&this.state.circles.forEach((e=>{e.shape.cx+=t,e.shape.cy=i-e.shape.cy;let a=new r(e);e.actionBool&&e.action(a,e,this._zr,this.group),this.group.add(a)})),this.state.droplets&&this.state.droplets.forEach((e=>{e.shape.cx+=t,e.shape.cy=i-e.shape.cy;let a=new c(e);this.group.add(a)})),this.state.ellipses&&this.state.ellipses.forEach((e=>{let a=z([e.shape.cx,e.shape.cy],this.state.center);e.shape.cx=a[0],e.shape.cy=a[1],a=z([e.shape.rx,e.shape.ry],this.state.center),e.shape.rx=a[0],e.shape.ry=a[1];let t=new p(e);this.group.add(t)})),this.state.lines&&this.state.lines.forEach((a=>{let t=z([a.shape.x1,a.shape.y1],this.state.center);a.shape.x1=t[0],a.shape.y1=t[1],t=z([a.shape.x2,a.shape.y2],this.state.center),a.shape.x2=t[0],a.shape.y2=t[1];let s=new e(a);this.group.add(s)})),this.state.polygons&&this.state.polygons.forEach((e=>{e.shape.points.forEach((e=>{z(e,this.state.center)}));let a=new s(e);this.group.add(a)})),this.state.polylines&&this.state.polylines.forEach((e=>{e.shape.points.forEach((e=>{z(e,this.state.center)}));let a=new d(e);this.group.add(a)})),this.state.rects&&this.state.rects.forEach((e=>{let a=z([e.shape.x,e.shape.y],this.state.center);e.shape.x=a[0],e.shape.y=a[1];let t=new y(e);e.actionBool&&e.action(t,e,this._zr,this.group),this.group.add(t)})),this.state.texts&&this.state.texts.forEach((e=>{e.position[0]+=t,e.position[1]=i-e.position[1];let s=new a(e);this.group.add(s)}))}}class w extends class{constructor(e,a){i("canvas",n),this._dom=e,this._zr=o(e,{renderer:"canvas"}),this.options=new Map,this.canvasRect=e.getBoundingClientRect(),this.canvasWidthHeight=[this.canvasRect.width,this.canvasRect.height],this.canvasWidth=this.canvasWidthHeight[0],this.canvasHeight=this.canvasWidthHeight[1]}getWidthHeightArray(){this._zr.resize();let e=this._dom.getBoundingClientRect();return[e.width,e.height]}addOption(e){this.options.set(e.name,e)}show(){this.options.forEach((e=>{let a=new t;if(e.group=this.group,this._zr.add(a),"BaseShape"==e.type){new L(a,e,this._zr).show()}}))}resize(){this._zr.resize(),this.options.forEach((e=>{}))}vector(){return this._zr.vector()}}{constructor(e,a){super(e,a)}addOption(e){this.centerTrans(e),this.addBound(e),this.setListen(e),e.ScaleAxisShow&&this.setScaleAxisLegend(e.dpi,e.Cx,e.Cy,e),super.addOption(e)}setScaleAxisLegend(e,a,t,s){const i=.0254;let n=e/(i*a),o=e/(i*t),h=20;s.texts.push({style:{fontSize:h,stroke:"#ccc",text:"比例尺（dpi96）"},position:[s.xyLinesCanvas[0]-150,s.xyLinesCanvas[3]-10]}),s.texts.push({style:{fontSize:h,stroke:"#ccc",text:"横轴：1/"+Math.round(n)},position:[s.xyLinesCanvas[0]-150,s.xyLinesCanvas[3]-15-h]}),s.texts.push({style:{fontSize:h,stroke:"#ccc",text:"纵轴：1/"+Math.round(o)},position:[s.xyLinesCanvas[0]-150,s.xyLinesCanvas[3]-20-40]})}setListen(s){let i=(e,a,t,s,i,n,o,h,l,r,c,p,d,y,x)=>{e>i.xyLinesCenterChangeCanvas[0]&&a<i.xyLinesCenterChangeCanvas[1]&&e<i.xyLinesCenterChangeCanvas[2]&&a>i.xyLinesCenterChangeCanvas[3]?(h={shape:{x1:t,y1:i.xyLinesCenterChangeCanvas[1],x2:t,y2:i.xyLinesCenterChangeCanvas[3]},style:r||{lineDash:[4]}},l={shape:{x1:i.xyLinesCenterChangeCanvas[0],y1:s,x2:i.xyLinesCenterChangeCanvas[2],y2:s},style:r||{lineDash:[4]}},d={position:[t-5,i.xyLinesCenterChangeCanvas[1]+5],style:x[0]},y={position:[i.xyLinesCenterChangeCanvas[0]-30,s-5],style:x[1]}):(h={shape:{x1:0,y1:0,x2:0,y2:0}},l={shape:{x1:0,y1:0,x2:0,y2:0}},d={position:[0,0],style:{fontSize:8,text:null}},y={position:[0,0],style:{fontSize:8,text:null}}),n.setShape(h.shape),o.setShape(l.shape),n.setStyle(h.style),o.setStyle(l.style),c.setStyle(d.style),c.setPosition(d.position),p.setStyle(y.style),p.setPosition(y.position)};if(s.mouseListen){let n,o,h,l,r,c,p,d,y;n=new e,o=new e,this._zr.add(n),this._zr.add(o),h=new e,l=new e,this._zr.add(h),this._zr.add(l),r=new a,c=new a,this._zr.add(r),this._zr.add(c),p=new a,d=new a,this._zr.add(p),this._zr.add(d);let x=[0,0],v=[999,999],u=null;this._zr.on("mousemove",(e=>{let C,f,g,M,S={lineDash:[4]},m={lineDash:[4],stroke:"#708090"},L=[{fontSize:8,text:"test0"},{fontSize:8,text:"test1"}],w=[{fill:"#708090",fontSize:8,text:"test0R"},{fill:"#708090",fontSize:8,text:"test1R"}];s.mouseListen.moveLinesRealTime||(x=[e.offsetX,e.offsetY],u||(u=setInterval((()=>{if(v[0]==x[0]){m={lineDash:[4]};let e,v=X([x[0],x[1]],s.Cx,s.Tx,s.Cy,s.Ty,s.center),R=Math.pow(v[0]-s.ground[0][0],2)+Math.pow(v[1]-s.ground[0][1],2),Y=-1;for(let a=0;a<s.ground.length;a++){const t=s.ground[a];e=Math.pow(v[0]-t[0],2)+Math.pow(v[1]-t[1],2),e<=R&&(R=e,Y=a)}let z,E,T=-1;for(let a=0;a<s.pipes.length;a++){const t=s.pipes[a].position;e=Math.pow(v[0]-t[0],2)+Math.pow(v[1]-t[1],2),e<=R&&(R=e,T=a)}if(Y>=0&&T<0&&(z=s.ground[Y],E=F(z.slice(),s.Cx,s.Tx,s.Cy,s.Ty,s.center)),y?y.removeAll():(y=new t,this._zr.add(y)),T>=0){z=s.pipes[T].position,E=F(z.slice(),s.Cx,s.Tx,s.Cy,s.Ty,s.center);let e=10,t=10;s.pipes[T].info&&s.pipes[T].info.forEach((s=>{let i=new a;y.add(i),console.log("endDataPositon",E),t+=1.5*e;let n={position:[E[0]+e,E[1]+t],style:{fontSize:e,text:s.name+":"}};i.setPosition(n.position),i.setStyle(n.style);let o=new a;y.add(o);let h={position:[E[0]+5.5*e,E[1]+t],style:{fontSize:e-1,text:s.value}};o.setPosition(h.position),o.setStyle(h.style)}))}S={lineDash:[4]},L=[{fontSize:8,text:z[0]},{fontSize:8,text:z[1]}],i(x[0],x[1],E[0],E[1],s,h,l,undefined,undefined,S,r,c,undefined,undefined,L),s.mouseListen.mouseLinesRealTimeEndShow||(m={lineDash:[4],stroke:"#FF000000"},w=[{fill:"#708090",fontSize:8,text:null},{fill:"#708090",fontSize:8,text:null}]),i(x[0],x[1],x[0],x[1],s,n,o,C,f,m,p,d,g,M,w),clearInterval(u),u=null}v=x.slice()}),168)));let R=X([x[0],x[1]],s.Cx,s.Tx,s.Cy,s.Ty,s.center);w=[{fill:"#708090",fontSize:8,text:R[0].toFixed(2)},{fill:"#708090",fontSize:8,text:R[1].toFixed(2)}],i(e.offsetX,e.offsetY,e.offsetX,e.offsetY,s,n,o,C,f,m,p,d,g,M,w)}))}}centerTrans(e){let a=[e.dataXYRealMinMax[0],e.dataXYRealMinMax[2]],t=[e.dataXYRealMinMax[1],e.dataXYRealMinMax[3]],s=[e.dataXYCanvasScaleMinMax[0],e.dataXYCanvasScaleMinMax[2]],i=[e.dataXYCanvasScaleMinMax[1],e.dataXYCanvasScaleMinMax[3]],n=[a[1]-a[0],t[1]-t[0]];e.yScaleplate||(e.yScaleplate=Math.ceil(n[1]/e.yScaleplateNumber)),t[0]=Math.floor(t[0]/e.yScaleplate)*e.yScaleplate,t[1]=Math.ceil(t[1]/e.yScaleplate)*e.yScaleplate,n=[a[1]-a[0],t[1]-t[0]];let o=[s[1]-s[0],i[1]-i[0]],h=[this.canvasWidth*o[0],this.canvasHeight*o[1]];e.center=[this.canvasWidth*e.centerScale[0],this.canvasHeight*(1-e.centerScale[1])],e.dataXYCanvasScaleAxisConsistent?n[0]/this.canvasWidth>n[1]/this.canvasHeight?e.Cy=e.Cx=h[0]/n[0]:e.Cx=e.Cy=h[1]/n[1]:(e.Cx=h[0]/n[0],e.Cy=h[1]/n[1]),e.Tx=this.canvasWidth*s[0]-a[0]*e.Cx,e.Ty=this.canvasHeight*i[0]-t[0]*e.Cy,e.dataXYCanvasScaleMinMaxDefine&&(e.Cx=h[0]/n[0],e.Cy=h[1]/n[1],e.Tx=this.canvasWidth*s[0]-a[0]*e.Cx,e.Ty=this.canvasHeight*i[0]-t[0]*e.Cy),e.xyLines||(e.xyLines=[0,0,s[0]+.05+n[0]/this.canvasWidth*e.Cx,i[0]+.1+n[1]/this.canvasHeight*e.Cy]),e.xyLinesCanvas=[e.xyLines[0]*this.canvasWidth,e.xyLines[1]*this.canvasHeight,e.xyLines[2]*this.canvasWidth,e.xyLines[3]*this.canvasHeight],e.xyLinesCenterChangeCanvas=[e.xyLinesCanvas[0]+e.center[0],e.center[1]-e.xyLinesCanvas[1],e.xyLinesCanvas[2]+e.center[0],e.center[1]-e.xyLinesCanvas[3]],e.circles.forEach((a=>{a.shape.r=a.shape.r*e.Cy,
//!!!!!圆形以y轴为准
a.shape.cx=a.shape.cx*e.Cx+e.Tx,a.shape.cy=a.shape.cy*e.Cy+e.Ty})),e.rects.forEach((a=>{a.shape.width=a.shape.width*e.Cx,a.shape.height=a.shape.height*e.Cy,a.shape.x=a.shape.x*e.Cx+e.Tx,a.shape.y=a.shape.y*e.Cy+e.Ty})),e.polylines.forEach((a=>{a.shape.points.forEach((a=>{a[0]=a[0]*e.Cx+e.Tx,a[1]=a[1]*e.Cy+e.Ty}))}));e.lines.push({shape:{x1:e.xyLinesCanvas[0]-2.5,y1:e.xyLinesCanvas[1],x2:e.xyLinesCanvas[0]-2.5,y2:e.xyLinesCanvas[3]},style:{lineWidth:5}});let l=e.yScaleplate*e.Cy,r=(e.xyLines[3]-e.dataXYCanvasScaleMinMax[1])*this.canvasHeight,c=(e.dataXYCanvasScaleMinMax[1]-e.xyLines[0])*this.canvasHeight;for(let p=0;p<r/l/2;p++){let a=e.dataXYCanvasScaleMinMax[0]*this.canvasWidth-2.5,t=e.dataXYCanvasScaleMinMax[1]*this.canvasHeight+2*p*l,s=e.dataXYCanvasScaleMinMax[0]*this.canvasWidth-2.5,i=e.dataXYCanvasScaleMinMax[1]*this.canvasHeight+(2*p+1)*l;e.lines.push({shape:{x1:a,y1:t,x2:s,y2:i},style:{lineWidth:2,stroke:"#FFFFFF"}}),e.texts.push({style:{fontSize:8,stroke:"#ccc",text:Math.round(Y(a,t,e.Cx,e.Cy,e.Tx,e.Ty)[1])},position:[a-24,t+8]})}for(let p=0;p<c/l/2-1;p++){let a=e.dataXYCanvasScaleMinMax[0]*this.canvasWidth-2.5,t=e.dataXYCanvasScaleMinMax[1]*this.canvasHeight-(2*p+1)*l,s=e.dataXYCanvasScaleMinMax[0]*this.canvasWidth-2.5,i=e.dataXYCanvasScaleMinMax[1]*this.canvasHeight-2*(p+1)*l;e.lines.push({shape:{x1:a,y1:t,x2:s,y2:i},style:{lineWidth:2,stroke:"#FFFFFF"}})}e.lines.push({shape:{x1:-5,y1:e.xyLinesCanvas[1],x2:e.xyLinesCanvas[2],y2:e.xyLinesCanvas[1]}})}addBound(e){let a,t=[[e.xyLinesCanvas[0],e.xyLinesCanvas[1]],[e.xyLinesCanvas[0],e.xyLinesCanvas[3]],[e.xyLinesCanvas[2],e.xyLinesCanvas[3]],[e.xyLinesCanvas[2],e.xyLinesCanvas[1]]];e.backgroundPolygons&&(e.backgroundPolygons=[{shape:{points:t},style:{stroke:"#00000040",fill:"#FFFFFFA0"}}]),e.backgroundPolygons.forEach((t=>{t.shape.points.forEach((a=>{a[0]+=e.center[0],a[1]=e.center[1]-a[1]})),a=new s(t),this._zr.add(a)}))}}class R extends w{constructor(e,a){super(e,a)}addOption(e){e.circles=[],e.lines=[],e.rects=[],e.polylines=[],e.texts=[],e.dataXYRealMinMax=[...e.ground[0],...e.ground[0]],this.transPipe(e),this.transGround(e),super.addOption(e)}addListen(){}transPipe(e){e.pipes.forEach((a=>{switch(e.dataXYRealMinMax[0]>a.position[0]&&(e.dataXYRealMinMax[0]=a.position[0]),e.dataXYRealMinMax[1]>a.position[1]&&(e.dataXYRealMinMax[1]=a.position[1]),e.dataXYRealMinMax[2]<a.position[0]&&(e.dataXYRealMinMax[2]=a.position[0]),e.dataXYRealMinMax[3]<a.position[1]&&(e.dataXYRealMinMax[3]=a.position[1]),a.type){case"rect":e.rects.push({shape:{x:a.position[0]-a.shape[0]/2,y:a.position[1]+a.shape[1]/2,width:a.shape[0],height:a.shape[1]},style:{stroke:"#000000",fill:"white",lineWidth:2},actionBool:!0,action:(e,a,t,s)=>{e.on("mousemove",(()=>{e.setStyle({stroke:"#FF0000"})})).on("mouseout",(()=>{e.setStyle({stroke:"#000000"})}))}});break;case"circle":e.circles.push({shape:{cx:a.position[0],cy:a.position[1],r:a.shape},style:{stroke:"#000000",fill:"#FFFFFF",lineWidth:2},actionBool:!0,action:(e,t,s,i)=>{console.log("r:"+a.position),e.on("mousemove",(()=>{e.setStyle({stroke:"#FF0000"})})).on("mouseout",(()=>{e.setStyle({stroke:"#000000"})}))}})}}))}transGround(e){e.ground.forEach((a=>{e.dataXYRealMinMax[0]>a[0]&&(e.dataXYRealMinMax[0]=a[0]),e.dataXYRealMinMax[1]>a[1]&&(e.dataXYRealMinMax[1]=a[1]),e.dataXYRealMinMax[2]<a[0]&&(e.dataXYRealMinMax[2]=a[0]),e.dataXYRealMinMax[3]<a[1]&&(e.dataXYRealMinMax[3]=a[1])})),e.polylines.push({shape:{points:JSON.parse(JSON.stringify(e.ground))}})}transXYLine(e){}}function Y(e,a,t,s,i,n){return[e=(e-i)/t,a=(a-n)/s]}function z(e,a){return e[0]=e[0]+a[0],e[1]=a[1]-e[1],e}function F(e,a,t,s,i,n){return e[0]=e[0]*a+t+n[0],e[1]=n[1]-(e[1]*s+i),e}function X(e,a,t,s,i,n){return e[0]=(e[0]-n[0]-t)/a,e[1]=(n[1]-e[1]-i)/s,e}const E={name:"EasyCAD",setup(){const e=v({foo:"bar"});return u((()=>{})),C((()=>{{i("canvas",n),console.log("zrender版本1",x);let e=document.getElementsByClassName("display")[0],a=o(e,{renderer:"canvas"}),s=a.getWidth(),h=a.getHeight(),l=!1;a.on("mousedown",(function(){l=!0})),a.on("mouseup",(function(){l=!1}));let c={stroke:"#ccc",fill:"white"},p=new t;for(let t=0;t<10;++t){let e=50*Math.random()+20,a=new r({shape:{cx:0,cy:0,r:e},position:[(.6*s-2*e)*Math.random()+e+.2*s,(.6*h-2*e)*Math.random()+e+.2*h],style:c,draggable:!0});a.on("mousemove",(function(){if(l){let e=p.getBoundingRect();v.setShape({x:e.x,y:e.y,width:e.width,height:e.height})}})),p.add(a)}a.add(p);let d=p.getBoundingRect(),v=new y({shape:{x:d.x,y:d.y,width:d.width,height:d.height},style:{fill:"none",stroke:"#14f1ff"}});a.add(v),a.resize()}{let t=document.getElementsByClassName("display")[1];var e=t.getContext("webgl",{antialias:!0,stencil:!1}),a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,.5,.5,.5,0,0,0,-.5,.5,-.5,0]),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);var s=e.createShader(e.VERTEX_SHADER);e.shaderSource(s,"attribute vec2 coordinates;void main(void) { gl_Position = vec4(coordinates,0.0, 1.0);}"),e.compileShader(s);var h=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(h,"void main(void) {gl_FragColor = vec4(1.0, 0.0, 0.0, 0.1);}"),e.compileShader(h);var l=e.createProgram();e.attachShader(l,s),e.attachShader(l,h),e.linkProgram(l),e.useProgram(l),e.bindBuffer(e.ARRAY_BUFFER,a);var c=e.getAttribLocation(l,"coordinates");e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(c),e.clearColor(.5,.5,.5,.9),e.enable(e.DEPTH_TEST),e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,t.width,t.height),e.drawArrays(e.TRIANGLES,0,1)}{let e=document.getElementsByClassName("display")[2];new w(e)}{let e=document.getElementsByClassName("display")[3],a=new R(e),t={unit:["m","米"],name:"坐标轴和管点",type:"BaseShape",listenBool:!0,centerScale:[.2,.15],dataXYRealMinMax:[],dataXYCanvasScaleMinMax:[0,.05,.6,.6],dataXYCanvasScaleAxisConsistent:!1,ScaleAxisShow:!0,dpi:96,yScaleplate:10,yScaleplateNumber:5,pipes:[{type:"rect",position:[3,5],shape:[1,1],info:[{name:"地表高程",value:"1"},{name:"高程间距",value:"2"},{name:"管线编号",value:"3"},{name:"高程间距",value:"4"}]},{type:"circle",position:[11,11],shape:.5,info:[{name:"地表高程",value:"1"},{name:"高程间距",value:"2"},{name:"管线编号",value:"3"},{name:"高程间距",value:"4"}]},{type:"rect",position:[17.5,25],shape:[2,1]},{type:"circle",position:[42,-11],shape:1},{type:"circle",position:[32,-5],shape:1},{type:"circle",position:[52,22],shape:1,info:[{name:"地表高程",value:"1222"},{name:"高程间距",value:"2222"},{name:"管线编号",value:"3222"},{name:"高程间距",value:"4333"}]}],ground:[[0,10],[10,13],[15,30],[20,20],[30,13],[45,30],[50,20],[60,20],[65,30],[130,20]],backgroundPolygons:[],infoShows:[{name:"地表高程",data:[],displayable:{}},{name:"里程",data:[],displayable:{}}],infoCenterShow:[{name:"平面间距",data:[],displayable:{}}],mouseListen:{moveLinesRealTime:!1,mouseLinesRealTimeEndShow:!1}};a.addOption(t),a.show()}})),{object:e}}};f("data-v-7e6c5f22");const T={class:"displayList"},_=[m("div",{id:"container0",class:"display"},null,-1),m("canvas",{id:"container1",class:"display"},null,-1),m("div",{id:"container2",class:"display"},null,-1),m("div",{id:"container3",class:"display"},null,-1)];g(),E.render=function(e,a,t,s,i,n){return M(),S("div",T,_)},E.__scopeId="data-v-7e6c5f22";export{E as default};
